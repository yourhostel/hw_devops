# postgres-deployment.yaml

apiVersion: v1
kind: Pod
metadata:
  name: postgres
  namespace: default
  annotations:
    vault.hashicorp.com/agent-inject: "true"
    vault.hashicorp.com/agent-inject-secret-database-config: "internal/database/config"
    vault.hashicorp.com/agent-inject-template-database-config: |
      {
        "username": "{{ .Data.data.username }}",
        "password": "{{ .Data.data.password }}"
      }
spec:
  serviceAccountName: internal-app
  containers:
  - name: postgres
    image: postgres:13
    env:
    - name: POSTGRES_DB
      value: mydatabase
    volumeMounts:
    - name: vault-secrets
      mountPath: /vault/secrets
      readOnly: true
  volumes:
  - name: vault-secrets
    emptyDir:
      medium: Memory





