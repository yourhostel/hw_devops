# postgres-deployment.yaml

apiVersion: v1
kind: Pod
metadata:
  name: payroll
  labels:
    app: payroll
  annotations:
    vault.hashicorp.com/agent-inject: 'true'
    vault.hashicorp.com/role: 'internal-app'
    vault.hashicorp.com/agent-inject-secret-postgres-user: 'internal/data/database/config#username'
    vault.hashicorp.com/agent-inject-secret-postgres-password: 'internal/data/database/config#password'
spec:
  serviceAccountName: internal-app
  containers:
  - name: postgres
    image: postgres:latest
    env:
      - name: POSTGRES_USER
        valueFrom:
          secretKeyRef:
            name: postgres-user
            key: username
      - name: POSTGRES_PASSWORD
        valueFrom:
          secretKeyRef:
            name: postgres-password
            key: password

